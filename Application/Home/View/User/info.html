<extend name="Public:base" />
<block name="title">
	<title>{$data.user_name}的用户资料 - Airex</title>
</block>
<block name="css">
	<link rel="stylesheet" type="text/css" href="__PUBLIC__/home/css/info.css">
</block>

<block name="page-main">

	<div class="col-sm-12 header-up">
		<div class="media">
			<div class="media-left">
				<img src="__PUBLIC__{$data.imgpath}" alt="{$data.user_name}" style="border-radius:6px" width=60 height=60></div>
			<div class="media-body">
				<div class="media-heading" style="padding-bottom:0;margin-bottom:0">
					<span>
						<big>{$data.user_name}</big>
					</span>
					<if condition="($Think.session.user neq null) && ($Think.session.user neq I('get.member'))">
						<input type="hidden" id="userID" value="{$data.id}">
						<if condition="$data.attention eq 0">
							<button type="button" id="addattention" class="btn btn-warning btn-sm">加入特别关注</button>
							<else />
							<button type="button" id="addattention" class="btn btn-sm">取消特别关注</button>
						</if>

					</if>
					<br>
				</div>

				<!--  个人简介  -->
				<div class="person-intro">{$data.resume}</div>
				<span class="info-number">
					<small>Airex 第 {$data.id} 号会员，性别：{$data.gender}，加入于 {$data.create_time}</small>
				</span>

			</div>
		</div>
	</div>

	<div class="col-sm-12 divider-thin"></div>
	<div class="col-sm-12 heading-down">

	<!--   个人资料网站链接   -->
<if condition="$data.url neq ''">
	<a href="{$data.url}" target="_blank">
			<span class="social badge">
				<img width="24" src="__PUBLIC__/home/img/social/social_home.png">
				&nbsp;
				<span>{$data.url}</span>
			</span>
	</a>
</if>

	
	</div>
	<div class="col-sm-12 divider"></div>
	<div class="col-sm-12 nav">
		<nav class="navbar navbar-default navbar-info">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">
						<img class="img-circle" width="23" src="__PUBLIC__{$data.imgpath}"></a>
				</div>
				<div class="collapse navbar-collapse">
					<ul class="nav navbar-nav navbar-left">
						<li class="active">
							<a href="{:U('User/Topic',['member'=>I('get.member')])}">查看 {$data.user_name} 创建的所有主题</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
	</div>


	<div class="col-sm-12 theme-display">
		<ul class="list-group">

			<volist name="topics['lists']" id="topic">
				<li class="list-group-item">
					<span>
						<span><a href="{:U('topic/detail',array('tid'=>$topic['tid']))}">{$topic.title}</a></span>
						<br>
						<span class="label label-default location"><a href="{:U('node/topics',array('node'=>$topic['node_name']))}">{$topic.node_name}</a></span>
						<span class="light-color">
							&nbsp;•&nbsp; <strong><a href="{:U('User/info',array('member'=>$topic['user_name']))}">{$topic.user_name}</a>
							&nbsp;•&nbsp;</strong>
							{$topic.publish_time} &nbsp;<if condition="$topic.last_comment_user neq null">• &nbsp;最后回复来自&nbsp;
							<a href="{:U('User/info',array('member'=>$topic['last_comment_user']))}"> <strong>{$topic.last_comment_user}</strong>
							</a></if>
						</span>
					</span>

					<a href="#">
						<span class="badge">{$topic.comments}</span>
					</a>
				</li>
			</volist>
		</ul>

	</div>



		<div class="col-sm-12 divider"></div>

		<div class="col-sm-12 info-reply">
			<div class="panel panel-default">
				<div class="panel-body reply-recent">
					<span>{$data.user_name} 最近回复了</span>
				</div>
				<if condition="$comments['lists'] eq null">
					<span style="font-size:14px;margin-left:10px"> 该用户暂未发表任何回复</span>
				</if>
				<volist name="comments['lists']" id="comment">

					<div class="panel-heading">
						<span>回复了 <a href="{:U('User/info',array('member'=>$comment['user_name']))}">{$comment.user_name}</a> 创建的主题 ›</span>
						<span class="reply-dark"><a href="{:U('topic/detail',array('tid'=>$comment['tid']))}">{$comment.title}</a></span>
					<span class="info-reply-time">
						<span>{$comment.publish_time}</span>
					</span>
						<img class="arrow" src="__PUBLIC__/home/img/arrow.png"></div>
					<div class="panel-body">
						<div class="reply-content">
							<span>{$comment.content}</span>
						</div>
					</div>

				</volist>

			</div>

			<div class="panel-body reply-footer">
			<span>» <a href="{:U('User/Reply',['member'=>I('get.member')])}">{$data.user_name}创建的更多回复</a></span>
		</div>
		</div>

	</block>

<block name="sidebar">

	<if condition="null == session('user')">
		<div class="sidebar-module sidebar-module-inset">
			<h4>注册/登录</h4>
			<p style="font-size:12px;color:grey">Airex是一个基于ThinkPHP的轻型bbs社区.</p>
			<div align="center"><br>
				<a class="btn btn-default" href="{:U('User/login')}" role="button">立即登陆</a><br><br>
				<p>没有账号?前往 <a href="{:U('User/register')}">注册</a></p>
			</div>
		</div>
		<else />
	<div class="sidebar-module sidebar-module-inset">
		<a href="{:U('User/info',array('member'=>$_SESSION['user']))}" title="" class="info">
			<img src="__PUBLIC__{$userInfo['userInfo']['imgpath']}" alt="..." class="img-rounded">
		</a>
		&nbsp;&nbsp;
		<label><a href="{:U('User/info',array('member'=>$_SESSION['user']))}" title="">{$Think.session.user}</a></label>
		<table class="table">
			<tr>
				<td align="center"><a class="info" href="#" title="" ><span class="lead">{$userInfo['userInfo']['nodes']}</span> <br><span>节点收藏</span></a></td>
				<td align="center"><a class="info" href="#" title="1" ><span class="lead">{$userInfo['userInfo']['topics']}</span> <br><span>主题收藏</span></a></td>
				<td align="center"><a class="info" href="{:U('User/attentions')}" title="1" ><span class="lead">{$userInfo['userInfo']['attentions']}</span> <br><span>特别关注</span></a></td>
			</tr>
		</table>
		<hr style="margin: 4px 0">
		<a href="{:U('topic/add')}" title="">
			<span class="glyphicon glyphicon-pencil" aria-hidden="true">&nbsp;创建新主题</span>
		</a>
		<hr style="margin: 8px 0">
		<a href="#" title="">
			<small>{$userInfo['notifications']}条未读提醒</small>
		</a>
		<a href="#" title=""><span class="badge badge-balance">财富: {$userInfo['userInfo']['wealth']}</span></a>
	</div>
</if>

</block>

	<block name="js">
		<script>
			$(document).ready(function() {
				$("ul li:eq(1)").addClass("nav-active");
				$('#addattention').bind('click',function(){
					if($('#addattention').text() == '加入特别关注'){
						var ID = $('#userID').val();
						var url = "{:U('User/add_attention')}";
						$.post(
								url,{userID:ID},
								function(data){
									console.log(data);
									if(data.status){
										$('#addattention').text('取消特别关注');
										$('#addattention').removeClass('btn-warning');
									}else{
										alert('关注失败');
									}
								},"json")
					}else if($('#addattention').text() == '取消特别关注'){
						var ID = $('#userID').val();
						var url = "{:U('User/remove_attention')}";
						$.post(
								url,{userID:ID},
								function(data){
									console.log(data);
									if(data.status){
										$('#addattention').text('加入特别关注');
										$('#addattention').addClass('btn-warning');
									}else{
										alert('取消关注失败');
									}
								},"json")
					}
				});
			});
		</script>
	</block>

